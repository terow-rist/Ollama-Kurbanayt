<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Page</title>
    <style>
        /* Copyright (c) 2025 by Valentino Župančić */

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #101010;
            overflow: hidden;
            position: relative;
        }

        /* Atom animation positioned to the right */
        .atom {
            position: absolute;
            top: 50%;
            right: 50px;
            transform: translateY(-50%);
            width: 300px;
            height: 300px;
        }

        .center {
            width: 30px;
            height: 30px;
            background: orange;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px orange, 0 0 50px orange;
        }

        .orbit {
            position: absolute;
            top: 20%;
            border-radius: 50%;
            border: 1px dashed rgba(255, 255, 255, 0.3);
            transform-style: preserve-3d;
            animation: rotate 3s linear infinite;
        }

        .orbit1 {
            width: 280px;
            height: 180px;
            transform: translate(-50%, -50%) rotateX(45deg);
        }

        .orbit2 {
            width: 280px;
            height: 200px;
            transform: translate(-50%, -50%) rotateX(-45deg);
            animation-duration: 5s;
        }

        .orbit3 {
            width: 280px;
            height: 200px;
            transform: translate(-50%, -50%) rotateY(90deg);
            animation-duration: 10s;
        }

        .electron {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px cyan, 0 0 30px cyan;
        }

        .electron1 { background: rgba(0, 150, 255); }
        .electron2 { background: rgba(0, 0, 255); }
        .electron3 { background: rgba(255, 0, 255); }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Chat box centered */
        #chat-container {
            width: 100vw;
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.128);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-right: 25%;
        }

        /* User info box in the top left corner */
        #user-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            padding: 10px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            font-size: 16px;
        }

        #username-display {
            margin-right: 10px;
        }

        #logout-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        #chat-display {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            max-width: 75%;
        }

        .user-message {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
        }

        .bot-message {
            background-color: #e4e6eb;
            align-self: flex-start;
        }

        #chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
            background: white;
        }

        input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            outline: none;
            font-size: 16px;
        }

        button {
            margin-left: 10px;
            padding: 10px 15px;
            border: none;
            background: #007bff;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="atom">
        <div class="center"></div>
        <div class="orbit orbit1">
            <div class="electron electron1"></div>
        </div>
        <div class="orbit orbit2">
            <div class="electron electron2"></div>
        </div>
        <div class="orbit orbit3">
            <div class="electron electron3"></div>
        </div>
    </div>

    <div id="chat-container">
        <!-- User info with logout button -->
        <div id="user-info">
            <span id="username-display">Username: </span>
            <button id="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div id="chat-display"></div>
        <div id="chat-input">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            const username = localStorage.getItem("username");
            if (username) {
                document.getElementById("username-display").textContent = "Username: " + username;
            } else {
                window.location.href = '/login'; // Redirect to login page if no username found
            }
        }

        async function sendMessage() {
            let inputField = document.getElementById("user-input");
            let message = inputField.value.trim();
            const username = localStorage.getItem("username");  // Ensure username is retrieved from localStorage
            if (message === "") return;

            let chatDisplay = document.getElementById("chat-display");
            let userMessage = document.createElement("div");
            userMessage.classList.add("message", "user-message");
            userMessage.textContent = message;
            chatDisplay.appendChild(userMessage);

            try {
                const response = await fetch('/ollama', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username, query: message }),
                });
                const data = await response.json();

                let botMessage = document.createElement("div");
                botMessage.classList.add("message", "bot-message");
                botMessage.textContent = data.answer;
                chatDisplay.appendChild(botMessage);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            } catch (error) {
                console.error("An error occurred:", error);
            }

            inputField.value = "";
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        function logout() {
            localStorage.removeItem("username");  // Remove username from localStorage
            window.location.href = '/login';  // Redirect to login page
        }
    </script>
</body>
</html>
